### Hotel Booking API Tests
### These tests can be used with VS Code REST Client extension

@baseUrl = https://localhost:7001/api/BookHotel
@adminToken = Bearer <your-admin-token-here>

### 1. Check Availability - Before Booking
GET {{baseUrl}}/check-availability?hotelId=1&roomId=1&checkInDate=2024-03-10T00:00:00Z&checkOutDate=2024-03-15T00:00:00Z&numberOfRooms=2

### 2. Create Booking - Guest (No Auth)
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2024-03-10T00:00:00Z",
  "checkOutDate": "2024-03-15T00:00:00Z",
  "numberOfRooms": 2,
  "numberOfGuests": 4,
  "guestName": "John Doe",
  "guestEmail": "john.doe@example.com",
  "guestPhone": "+1-555-0123",
  "specialRequests": "Late check-in if possible"
}

### 3. Create Booking - Standard Room
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 2,
  "checkInDate": "2024-03-20T00:00:00Z",
  "checkOutDate": "2024-03-25T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 2,
  "guestName": "Jane Smith",
  "guestEmail": "jane.smith@example.com",
  "guestPhone": "+1-555-0456"
}

### 4. Create Booking - Miami Ocean View
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 2,
  "roomId": 3,
  "checkInDate": "2024-04-01T00:00:00Z",
  "checkOutDate": "2024-04-05T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 4,
  "guestName": "Robert Johnson",
  "guestEmail": "robert.j@example.com",
  "guestPhone": "+1-555-0789",
  "specialRequests": "Ocean view preferred"
}

### 5. Get Booking by ID
# Replace {id} with actual booking ID from creation response
GET {{baseUrl}}/1

### 6. Get Booking by Reference
# Replace {reference} with actual booking reference from creation response
GET {{baseUrl}}/reference/BK20240315101530001234

### 7. Cancel Booking
# Replace {id} with actual booking ID
POST {{baseUrl}}/1/cancel
Content-Type: application/json

{
  "bookingId": 1,
  "cancellationReason": "Change of travel plans"
}

### 8. Cancel Booking - Without Reason
POST {{baseUrl}}/2/cancel
Content-Type: application/json

{}

### 9. Get My Bookings (Requires Authentication)
GET {{baseUrl}}/my-bookings
Authorization: {{adminToken}}

### 10. Get Hotel Bookings (Admin Only)
GET {{baseUrl}}/hotel/1
Authorization: {{adminToken}}

### 11. Get Hotel Bookings with Date Filter
GET {{baseUrl}}/hotel/1?startDate=2024-03-01T00:00:00Z&endDate=2024-03-31T00:00:00Z
Authorization: {{adminToken}}

### ERROR CASES

### 12. Past Check-in Date (Should Fail - 400)
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2020-01-01T00:00:00Z",
  "checkOutDate": "2020-01-05T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 2,
  "guestName": "Test User",
  "guestEmail": "test@example.com",
  "guestPhone": "+1-555-0000"
}

### 13. Invalid Date Range (Should Fail - 400)
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2024-03-15T00:00:00Z",
  "checkOutDate": "2024-03-10T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 2,
  "guestName": "Test User",
  "guestEmail": "test@example.com",
  "guestPhone": "+1-555-0000"
}

### 14. Too Many Guests for Room (Should Fail - 400)
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2024-03-10T00:00:00Z",
  "checkOutDate": "2024-03-15T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 10,
  "guestName": "Test User",
  "guestEmail": "test@example.com",
  "guestPhone": "+1-555-0000"
}

### 15. Non-existent Hotel (Should Fail - 404)
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 999,
  "roomId": 1,
  "checkInDate": "2024-03-10T00:00:00Z",
  "checkOutDate": "2024-03-15T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 2,
  "guestName": "Test User",
  "guestEmail": "test@example.com",
  "guestPhone": "+1-555-0000"
}

### 16. Insufficient Availability (Should Fail - 400)
# First, book all available rooms, then try to book one more
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2024-05-01T00:00:00Z",
  "checkOutDate": "2024-05-05T00:00:00Z",
  "numberOfRooms": 100,
  "numberOfGuests": 2,
  "guestName": "Test User",
  "guestEmail": "test@example.com",
  "guestPhone": "+1-555-0000"
}

### 17. Invalid Email Format (Should Fail - 400)
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2024-03-10T00:00:00Z",
  "checkOutDate": "2024-03-15T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 2,
  "guestName": "Test User",
  "guestEmail": "not-an-email",
  "guestPhone": "+1-555-0000"
}

### 18. Get Non-existent Booking (Should Fail - 404)
GET {{baseUrl}}/999

### 19. Cancel Non-existent Booking (Should Fail - 404)
POST {{baseUrl}}/999/cancel

### CAPACITY MANAGEMENT TESTS

### 20. Test Capacity Decrease
# Step 1: Check initial availability
GET https://localhost:7001/api/HotelSearch/hotels/1?checkInDate=2024-06-01T00:00:00Z&checkOutDate=2024-06-05T00:00:00Z&numberOfGuests=2

###
# Step 2: Create booking
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2024-06-01T00:00:00Z",
  "checkOutDate": "2024-06-05T00:00:00Z",
  "numberOfRooms": 3,
  "numberOfGuests": 2,
  "guestName": "Capacity Test",
  "guestEmail": "capacity@example.com",
  "guestPhone": "+1-555-1111"
}

###
# Step 3: Check availability again - should be 3 less
GET https://localhost:7001/api/HotelSearch/hotels/1?checkInDate=2024-06-01T00:00:00Z&checkOutDate=2024-06-05T00:00:00Z&numberOfGuests=2

### 21. Test Capacity Restore on Cancellation
# Step 1: Note the booking ID from the previous booking
# Step 2: Cancel it
POST {{baseUrl}}/1/cancel
Content-Type: application/json

{
  "cancellationReason": "Testing capacity restore"
}

###
# Step 3: Check availability again - should be restored
GET https://localhost:7001/api/HotelSearch/hotels/1?checkInDate=2024-06-01T00:00:00Z&checkOutDate=2024-06-05T00:00:00Z&numberOfGuests=2

### 22. Multiple Bookings - Cumulative Capacity Decrease
# Booking 1
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 2,
  "checkInDate": "2024-07-01T00:00:00Z",
  "checkOutDate": "2024-07-05T00:00:00Z",
  "numberOfRooms": 2,
  "numberOfGuests": 2,
  "guestName": "User One",
  "guestEmail": "user1@example.com",
  "guestPhone": "+1-555-0001"
}

###
# Booking 2
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 2,
  "checkInDate": "2024-07-01T00:00:00Z",
  "checkOutDate": "2024-07-05T00:00:00Z",
  "numberOfRooms": 3,
  "numberOfGuests": 2,
  "guestName": "User Two",
  "guestEmail": "user2@example.com",
  "guestPhone": "+1-555-0002"
}

###
# Check availability - should show 5 less than original
GET https://localhost:7001/api/HotelSearch/hotels/1?checkInDate=2024-07-01T00:00:00Z&checkOutDate=2024-07-05T00:00:00Z&numberOfGuests=2

### INTEGRATION TESTS

### 23. Complete Booking Flow
# Step 1: Search for hotels
GET https://localhost:7001/api/HotelSearch/search?destination=New%20York&checkInDate=2024-08-01T00:00:00Z&checkOutDate=2024-08-05T00:00:00Z&numberOfGuests=2&numberOfRooms=1

###
# Step 2: Check specific room availability
GET {{baseUrl}}/check-availability?hotelId=1&roomId=1&checkInDate=2024-08-01T00:00:00Z&checkOutDate=2024-08-05T00:00:00Z&numberOfRooms=1

###
# Step 3: Create booking
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2024-08-01T00:00:00Z",
  "checkOutDate": "2024-08-05T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 2,
  "guestName": "Integration Test",
  "guestEmail": "integration@example.com",
  "guestPhone": "+1-555-9999"
}

###
# Step 4: Retrieve booking by reference
# Use the reference from the booking response
GET {{baseUrl}}/reference/BK20240315101530001234

###
# Step 5: Cancel booking
POST {{baseUrl}}/1/cancel

### 24. Maximum Duration Booking (Should Fail if > 30 nights)
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2024-09-01T00:00:00Z",
  "checkOutDate": "2024-10-15T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 2,
  "guestName": "Long Stay Test",
  "guestEmail": "longstay@example.com",
  "guestPhone": "+1-555-3333"
}

### 25. Same Day Check-in/Check-out (Should Fail)
POST {{baseUrl}}/book
Content-Type: application/json

{
  "hotelId": 1,
  "roomId": 1,
  "checkInDate": "2024-03-10T00:00:00Z",
  "checkOutDate": "2024-03-10T00:00:00Z",
  "numberOfRooms": 1,
  "numberOfGuests": 2,
  "guestName": "Same Day Test",
  "guestEmail": "sameday@example.com",
  "guestPhone": "+1-555-4444"
}
